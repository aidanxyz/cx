{% extends "base.html" %}
{% block content %}
	<div class="row">
		<div class="span9">
			<div id="item_info" item-id="{{ item.id }}">
				<h1 id="item_name">{{ item.name }}</h1>
				{% if experience %}
					<span id="usage_info" class="muted">
						You used this {{ item.category }} for <a>{{ experience.duration }}</a> and rated as <a>{{ experience.rating }}</a>
						<a href="/item/{{ item.id }}/usage/edit/" id="edit">edit</a>
					</span>
				{% else %}
					{% include "items/usage-form.html" %}
					{% include "items/not_used-modal.html" %}
				{% endif %}
			</div>
		</div>
	</div>
	<div class="row">
		<div class="span1"></div>
		<div class="span4" id="pros">
			<h3>What I like:</h3>
			<ul>
				{% for feedback in feedbacks %}
					{% if feedback.is_positive %}
						{% include "reviews/feedbacks/feedback-li.html" %}
					{% endif %}
				{% endfor %}
			</ul>
			{% if user.is_authenticated and experience %}
				{% include "reviews/feedbacks/add.html" with is_positive=1 %}
			{% else %}
				<a href="javascript:void(0);" id="add_feedback">Add feedback</a>
				{% include "reviews/feedbacks/add.html" with is_positive=1 hidden=True%}
			{% endif %}
		</div>
		<div class="span4" id="cons">
			<h3>What I don't like:</h3>
			<ul>
				{% for feedback in feedbacks %}
					{% if not feedback.is_positive %}
						{% include "reviews/feedbacks/feedback-li.html" %}
					{% endif %}
				{% endfor %}
			</ul>
			{% if user.is_authenticated and experience %}
				{% include "reviews/feedbacks/add.html" with is_positive=0 %}
			{% else %}
				<a href="javascript:void(0);" id="add_feedback">Add feedback</a>
				{% include "reviews/feedbacks/add.html" with is_positive=0 hidden=True%}
			{% endif %}
		</div>
	</div>
	<!-- ICanHaz templates -->
	<script type="text/html" id="feedback">
		<li class="well" feedback-id='{% verbatim %}{{ id }}{% endverbatim %}'>
			<span id="score">0</span>
			{% verbatim %}
			{{ body }}
			{% endverbatim %}
			<p id="actions">
				<a class="vote" type-id="1" weight="1" href="javascript:void(0);">Agree(<span id='count'>0</span>) </a>
				<a class="vote" type-id="2" weight="-1" href="javascript:void(0);">Disagree(<span id='count'>0</span>)</a>
			</p>
			<div id="info">
				<p id="priorities">
					priorities: 1: <span class="priority" id="1">0</span>, 2: <span class="priority" id="2">0</span>, 3: <span class="priority" id="3">0</span>
				</p>
				<p id="details">
					<a href="/feedbacks/{% verbatim %}{{ id }}{% endverbatim %}/details">Details(<span id="count">0</span>)</a>
				</p>
			</div>
		</li>
	</script>
	<script type="text/html" id="usage_info">
		<span id="usage_info" class="muted">
			You used this {{ item.category }} for 
			{% verbatim %}
			<a>{{ duration }}</a> and rated as <a>{{ rating }}</a> 
			{% endverbatim %}
			<a href="/item/{{ item.id }}/usage/edit/" id="edit">edit</a>
		</span>
	</script>
	<script type="text/html" id="similar_feedback">
		<li id="similar_feedback">
			{% verbatim %}
			<a href="#{{ id }}">{{ body }}</a>
			{% endverbatim %}
		</li>
	</script>
	<script type="text/html" id="set_priority">
		{% verbatim %}
		<a href="javascript:void(0);" class="set_priority">{{ value }}</a>
		{% endverbatim %}
	</script>
	<!-- JavaScript -->
	<script type="text/javascript">
		$(document).ready(function() {
			{% if user.is_authenticated %}
				{% if experience %}
					siteNameSpace.exec('review', { is_authenticated: true, is_used: true });
				{% else %}
					siteNameSpace.exec('review', { is_authenticated: true, is_used: false });
				{% endif %}
			{% else %}
				siteNameSpace.exec('review');	// default configuration is set to {is_authenticated: false}, so guest() will fire
			{% endif %}
		});
	</script>
{% endblock %}